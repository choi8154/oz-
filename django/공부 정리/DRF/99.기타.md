# 정리가 귀찮은 정보 따로 정리

## 1. permission.py
- 권한 체크용 클래스를 두는 파일.

### 1) 작성 방법
- permission.py를 app 모듈에 생성하여 작성함.
```python
from rest_framework import permissions

class CustomReadOnly(permissions.BasePermission):
    """
    permissions.BasePermission을 상속하고 has_object_permission 후크를 오버라이딩 하여
    이 클레스를 옵션에 넣은 view는 권한 체크를 하여 객체에 접근을 제한 함.
    request.moethod의 요청이 안전한(get)요청이면 True를 반환하고,
    obj객체의 유저와 request요청을 보내는 유저의 정보가 일치하면 True를 반환함.
    """
    def has_object_permission(self, request, view, obj):
        if request.method in permissions.SAFE_METHODS:
            return True
        return obj.user == request.user

```

### 2) views에 적용 방법
- views.py에 해당 클래스를 import하여 views에 적용시킴.
1. generics를 사용하여 설정하는 방법
```python
from rest_framework import generics
from .serializer import ProfileSerializer
from .permission import CustomReadOnly

class Profile(generics.RetrieveUpdateAPIView):
    queryset = Profile.objects.all()
    serializer_class = ProfileSerializer
    permission_classes = [CustomReadOnly]
```

2. APIView만 사용한 CBV에서 설정하는 방법
```python
from .serializer import ProfileSerializer
from .permission import CustomReadOnly
from rest_framwork.views import APIView
from .model import Post
from rest_framwork.generics import get_objects_or_404

class Profile(APIView):
    permission_classes = [CustomReadyOnly]
    """
    get_object를 객체를 검증하는 함수로 생성.
    permission_classes를 등록해서 self(객체)는 chect_object_permissions를 사용하여
    요청의 정보와 객체를 검증한 후 True가 나올 시 post를 return함.
    """
    def get_object(self, request, pk):
        post = get_object_or_404(Post, pk=pk)
        self.check_object_permissions(self.request, post)
        return post

    def post(request, pk):
        post = self.get_object(pk)
        ...
```
> 팁! 왜 기껏 has_object_permission을 만들어 놓고 직접 사용 안하고 check_object_permissions를 사용하는거야?
그 이유는 APIView에는 check_object_permissions라는 메서드가 있음. 그 안에는 permission_classes에 등록한 클래스를 사용해 대신 검증/예외처리를 해 줌. 만약 이걸 사용하지 않는다면 우리는 object_permission을 직접 호출해서 모든 오류에 대한 예외처리를 직접 만들어야함.


## 2. 